<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resident Dashboard</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../css/res-navbar.css">
    <link rel="stylesheet" href="../css/res-dashboard.css">
    <link rel="stylesheet" href="../css/res-profile-style.css">
    <link rel="stylesheet" href="../css/res-notif-general.css">

</head>

<body>

    <nav class="navbar bg-light ">
        <div class="container-fluid">
            <!-- Hamburger menu and logo -->
            <div class="d-flex align-items-center">
                <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas"
                    data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar" title="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="navbar-logo">
                    <img src="../asset/img/brgy_official_seal.png" alt="Barangay Ligaya official seal">
                    <a class="me-auto navbar-brand " href="../index.html">Ligaya</a>
                </div>
            </div>

            <!-- Offcanvas menu content -->
            <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasNavbar"
                aria-labelledby="offcanvasNavbarLabel">
                <div class="offcanvas-header">
                    <h5 class="offcanvas-title" id="offcanvasNavbarLabel">Ligaya</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                </div>
                <div class="offcanvas-body">
                    <ul class="navbar-nav justify-content-center flex-grow-1 pe-3">
                        <!-- Nav items -->
                        <li class="nav-item">
                            <a class="nav-link" href="../index.html">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="../about.html">About</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="../index.html#service">Service</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="../announcement.html">Announcement</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="../leaderboard.html">Leaderboard</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="../project.html">Brgy Projects</a>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Profile & notification dropdown -->
            <div class="d-flex align-items-center">
                <!-- Notification Bell -->
                <div class="nav-item dropdown " id="notificationIcon">
                    <button class="btn btn-outline-secondary position-relative" type="button" data-bs-toggle="dropdown"
                        id="notificationBell">
                        <i class="fas fa-bell"></i>
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
                            id="notificationCount">
                            3
                        </span>
                    </button>
                    <div class="dropdown-menu dropdown-menu-end notification-dropdown" id="notificationDropdown">
                        <div class="dropdown-header d-flex justify-content-between align-items-center">
                            <span>Notifications</span>
                            <button class="btn btn-sm btn-link text-decoration-none" onclick="markAllAsRead()">
                                Mark all as read
                            </button>
                        </div>
                        <div class="dropdown-divider"></div>
                        <div id="notificationList">
                            <!-- Notifications will be populated here -->
                        </div>
                        <div class="dropdown-divider"></div>
                        <div class="dropdown-footer text-center">
                            <a href="notification.html" class="text-decoration-none" id="seeAllNotifications">
                                See All Notifications
                            </a>
                        </div>
                    </div>
                </div>

                <div class="dropdown user-dropdown ms-2" id="userDropdown">
                    <button class="btn p-0 border-0 bg-transparent position-relative" type="button"
                        data-bs-toggle="dropdown" aria-expanded="false">
                        <!-- Profile image -->
                        <img src="../asset/img/default_acc_icon.png" alt="User" class="user-icon-rounded">

                        <!-- Dropdown arrow overlay -->
                        <span class="dropdown-arrow-icon">
                            <i class="bi bi-chevron-down"></i>
                        </span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li>
                            <h6 class="dropdown-header user-name" id="userName">User Name</h6>
                        </li>
                        <li><a class="dropdown-item" href="dashboard.html">Dashboard</a></li>
                        <li><a class="dropdown-item" href="convert-points.html">Convert Points</a></li>
                        <li><a class="dropdown-item" href="redeem-rewards.html">Redeem Rewards</a></li>
                        <li><a class="dropdown-item" href="document-request/document-request.html">Document Requests</a>
                        </li>
                        <li><a class="dropdown-item" href="complaints.html">Submit Complaints</a></li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li><a class="dropdown-item" href="settings.html">Settings</a></li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li><a class="dropdown-item" href="../index.html" id="logoutButton">Logout</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>


    <div class="container mt-4">
        <!-- Welcome Section -->
        <div class="row mb-4">
            <!-- profile and points overview -->
            <div class="col-md-8 order-1">
                <div class="card mb-3">
                    <div class="card-body welcome-card">
                        <div class="d-flex align-items-center">
                            <div class="p-3">
                                <img src="../asset/img/hero-bg.jpg" class="rounded-circle me-3 profile_pic"
                                    alt="Profile">
                            </div>
                            <div>
                                <h2><span id="residentName"></span></h2>
                                <p class="text-muted mb-2" id="residentCode"></p>
                                <div class="badge-layout d-flex gap-1">
                                    <div class="badge-container">
                                        <span class="badge rounded-pill bg-primary">
                                            <i class="fas fa-star me-1"></i> <span id="creditPoints">0</span> Credit
                                            Points
                                        </span>
                                        <span class="badge rounded-pill bg-success">
                                            <i class="fas fa-gift me-1"></i> <span id="redeemablePoints">0</span>
                                            Redeemable Points
                                        </span>
                                    </div>
                                    <div class="badge-container">
                                        <span class="badge rounded-pill bg-info">
                                            <i class="fas fa-calendar-check me-1"></i> <span
                                                id="totalParticipated">0</span> Events Attended
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- badges card -->
                <div class="card mb-3">
                    <div class="card-header bg-light d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Badges</h5>
                        <a href="#" class="text-decoration-none small" data-bs-toggle="modal"
                            data-bs-target="#badgesModal">
                            View All
                        </a>
                    </div>
                    <div class="card-body">
                        <div class="d-flex flex-wrap gap-4 justify-content-start">
                            <!-- Badge 1 -->
                            <div class="text-center">
                                <img src="../asset/img/hero-bg.jpg" alt="First Login Badge" class="img-fluid badge-img">
                                <p class="mt-2 mb-0 badge-text">First Login</p>
                            </div>
                            <!-- Badge 2 -->
                            <div class="text-center">
                                <img src="../asset/img/hero-bg.jpg" alt="Document Master Badge"
                                    class="img-fluid badge-img">
                                <p class="mt-2 mb-0 badge-text">Document Master</p>
                            </div>
                            <!-- Badge 3 -->
                            <div class="text-center">
                                <img src="../asset/img/hero-bg.jpg" alt="Community Helper Badge"
                                    class="img-fluid badge-img">
                                <p class="mt-2 mb-0 badge-text">Community Helper</p>
                            </div>
                            <!-- Show more indicator -->
                            <div class="text-center">
                                <div class="badge-img d-flex align-items-center justify-content-center bg-light border"
                                    style="color: #666;">
                                    +9
                                </div>
                                <p class="mt-2 mb-0 badge-text">More...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- quick actions -->
            <div class="col-md-4 order-2 order-md-3">
                <div class="card">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">Quick Actions</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-primary" data-bs-toggle="modal"
                                data-bs-target="#documentRequestModal">
                                <i class="fas fa-calendar-plus me-2"></i>Request Document
                            </button>
                            <a href="#convertPoints" class="btn btn-outline-success" data-bs-toggle="modal"
                                data-bs-target="#convertPointsModal">
                                <i class="fas fa-exchange-alt me-2"></i>Convert Points
                            </a>
                            <a href="redeem-rewards.html" class="btn btn-outline-info">
                                <i class="fas fa-gift me-2"></i>View Rewards
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>




        <div class="row mb-4">
            <!--  Leaderboard -->
            <div class="col-md-6">
                <div class="card h-100">
                    <div class="card-header d-flex justify-content-between align-items-center bg-light">
                        <h5 class="mb-0">Leaderboard</h5>
                        <a href="../leaderboard.html" class="btn btn-sm btn-primary">Full Leaderboard</a>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Rank</th>
                                        <th>Resident</th>
                                        <th>Points</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><span class="badge bg-warning text-dark">1</span></td>
                                        <td>
                                            <img src="https://via.placeholder.com/30" class="rounded-circle me-2"
                                                alt="">
                                            Sarah Johnson
                                        </td>
                                        <td>580</td>
                                    </tr>
                                    <tr>
                                        <td><span class="badge bg-secondary">2</span></td>
                                        <td>
                                            <img src="https://via.placeholder.com/30" class="rounded-circle me-2"
                                                alt="">
                                            Mike Thompson
                                        </td>
                                        <td>495</td>
                                    </tr>
                                    <tr>
                                        <td><span class="badge bg-secondary">3</span></td>
                                        <td>
                                            <img src="https://via.placeholder.com/30" class="rounded-circle me-2"
                                                alt="">
                                            Lisa Rodriguez
                                        </td>
                                        <td>460</td>
                                    </tr>
                                    <tr>
                                        <td><span class="badge bg-secondary">4</span></td>
                                        <td>
                                            <img src="https://via.placeholder.com/30" class="rounded-circle me-2"
                                                alt="">
                                            David Williams
                                        </td>
                                        <td>390</td>
                                    </tr>
                                    <tr class="table-primary">
                                        <td><span class="badge bg-primary">5</span></td>
                                        <td>
                                            <img src="https://via.placeholder.com/30" class="rounded-circle me-2"
                                                alt="">
                                            <strong>Jane Doe (You)</strong>
                                        </td>
                                        <td><strong>350</strong></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <!--  My Participation -->
            <div class="col-md-6 mb-4 mb-md-0">
                <div class="card h-100">
                    <div class="card-header d-flex justify-content-between align-items-center bg-light">
                        <h5 class="mb-0">My Participation</h5>
                        <a href="#" class="btn btn-sm btn-primary">View All</a>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Event</th>
                                        <th>Date</th>
                                        <th>Status</th>
                                        <th>Points</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Spring Cleanup</td>
                                        <td>Apr 10, 2025</td>
                                        <td><span class="badge bg-success">Attended</span></td>
                                        <td>50</td>
                                    </tr>
                                    <tr>
                                        <td>Resident Meeting</td>
                                        <td>Apr 5, 2025</td>
                                        <td><span class="badge bg-success">Attended</span></td>
                                        <td>25</td>
                                    </tr>
                                    <tr>
                                        <td>Recycling Workshop</td>
                                        <td>Mar 25, 2025</td>
                                        <td><span class="badge bg-success">Attended</span></td>
                                        <td>35</td>
                                    </tr>
                                    <tr>
                                        <td>Fitness Class</td>
                                        <td>Mar 15, 2025</td>
                                        <td><span class="badge bg-danger">Missed</span></td>
                                        <td>0</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>


        </div>

        <!-- Convert Points Modal -->
        <div class="modal fade" id="convertPointsModal" tabindex="-1" data-bs-backdrop="static"
            data-bs-keyboard="false">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Convert Credit Points</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row mb-3">
                            <div class="col-6">
                                <div class="card bg-light">
                                    <div class="card-body text-center">
                                        <h6>Available Credits</h6>
                                        <h3 class="text-primary" id="modalAvailableCredit"></h3>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="card bg-light">
                                    <div class="card-body text-center">
                                        <h6>Redeemable Points</h6>
                                        <h3 class="text-success" id="modalRedeemablePoints"></h3>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <form>
                            <div class="mb-3">
                                <label for="creditPointsToConvert" class="form-label">Credit Points to Convert</label>
                                <input type="number" class="form-control" id="creditPointsToConvert" min="10" max="350"
                                    step="10">
                            </div>
                            <div class="mb-3">
                                <label for="redeemableResult" class="form-label">You will receive</label>
                                <input type="text" class="form-control" id="redeemableResult"
                                    value="0 redeemable points" disabled>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary">Convert Now</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Document Request Modal iframe-->
        <div class="modal fade" id="documentRequestModal" tabindex="-1" aria-labelledby="documentRequestModalLabel"
            data-bs-backdrop="static" data-bs-keyboard="false" aria-hidden="true">
            <div class="modal-dialog modal-xl"> <!-- make it wide for better iframe view -->
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Request a Document</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body p-0" style="height: 100vh;">
                        <iframe id="documentIframe" src="document-request/request-document.html" frameborder="0"
                            style="width:100%; height:100%; border:none;">
                        </iframe>
                    </div>
                </div>
            </div>
        </div>

        <!-- Badges Modal with iframe -->
        <div class="modal fade" id="badgesModal" tabindex="-1" aria-labelledby="badgesModalLabel" aria-hidden="true"
            data-bs-backdrop="static" data-bs-keyboard="false">
            <div class="modal-dialog modal-xl modal-dialog-centered">
                <div class="modal-content" style="height: 80vh;">
                    <div class="modal-header">
                        <h5 class="modal-title" id="badgesModalLabel">All Badges</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body p-0">
                        <iframe src="badges-shelf.html" width="100%" height="100%" frameborder="0"
                            style="border:0; height:100%;"></iframe>
                    </div>
                    <div class="modal-footer bg-light">
                    <small class="text-muted">Click on badges to see details • Collect more by using our services!</small>
                </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Footer -->
    <footer class="footer bg-dark text-white py-4">
        <div class="container">
            <div class="row">
                <div class="col-md-6 text-center text-md-start">
                    <p class="mb-0">&copy; 2025 Barangay Ligaya. All rights reserved.</p>
                </div>
                <div class="col-md-6 text-center text-md-end">
                    <a href="#" class="text-white me-2">Privacy Policy</a> |
                    <a href="#" class="text-white me-2">Terms of Service</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script src="../js/resident-dashboard.js"></script>
    <script src="../js/resident-credits-conversion.js"></script>
    <script src="../js/login-status-script.js"></script>
    <script src="../js/logout-script.js"></script>
    <script src="../js/res-notification-script.js"></script>
    <script src="../js/res-badges-shelf-script.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const modal = document.getElementById('documentRequestModal');
            const iframe = document.getElementById('documentIframe');

            // When modal is about to show, load the iframe with fresh content
            modal.addEventListener('show.bs.modal', function () {
                // Add timestamp to prevent caching and ensure fresh load
                const timestamp = new Date().getTime();
                iframe.src = `document-request/request-document.html?t=${timestamp}`;
            });

            // When modal is hidden, clear the iframe src to reset it
            modal.addEventListener('hidden.bs.modal', function () {
                iframe.src = '';
            });

            // Listen for messages from the iframe (when form is submitted)
            window.addEventListener('message', function (event) {
                // Check if the message is from our iframe
                if (event.source === iframe.contentWindow) {
                    if (event.data.type === 'formSubmitted') {
                        // Close the modal when form is submitted
                        const modalInstance = bootstrap.Modal.getInstance(modal);
                        modalInstance.hide();
                    }
                }
            });

            // Optional: Handle iframe load to hide the header
            iframe.addEventListener('load', function () {
                try {
                    // Try to access iframe content (will only work if same-origin)
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    const header = iframeDoc.querySelector('h2');
                    if (header) {
                        header.style.display = 'none';
                    }
                } catch (e) {
                    // If cross-origin, we can't access iframe content directly
                    // The iframe content should handle hiding its own header
                    console.log('Cross-origin iframe detected, header hiding should be handled in iframe content');
                }
            });
        });
    </script>


</body>

</html>